<!DOCTYPE HTML>
<html>
    <head>
        <style>
            body {
                text-align: center;
            }
        </style>
        <script src="http://d3lp1msu2r81bx.cloudfront.net/kjs/js/lib/kinetic-v5.0.2.min.js"></script>
    </head>
    <body>
        <div id="container"></div>
        <script defer="defer">
            var stage = new Kinetic.Stage({
                container: 'container',
                width: 400,
                height: 400
            });
            var shapesLayer = new Kinetic.Layer();

            /*
            * create a group which will be used to combine
            * multiple simple shapes.  Transforming the group will
            * transform all of the simple shapes together as
            * one unit
            */
            var group = new Kinetic.Group({
                x: 0,
                y: 0
            });

            for(var n = 0; n < 3; n++) {
                // anonymous function to induce scope
                (function() {
                    var i = n;
                    var box = new Kinetic.Rect({
                        x: i * 50,
                        y: i * 50,
                        width: 400 - (i * 100),
                        height: 400 - (i * 100),
                        fill: 'white',
                        stroke: 'black',
                        strokeWidth: 4
                    });
   

                    if(i == 2) {
                        var  vertical_line = new Kinetic.Line({
                            points: [200, 0, 200, 400],
                            stroke: 'black',
                            strokeWidth: 4
                        });
                        var  horizontal_line = new Kinetic.Line({
                            points: [0, 200, 400, 200],
                            stroke: 'black',
                            strokeWidth: 4
                        });
                        group.add(horizontal_line);
                        group.add(vertical_line);

                    }

                    group.add(box);

                        for(var j = 0; j < 3; j++) {
                            var cx = (i * 50) + (j * (.5 *(400 - (i *100))));

                            for(var k = 0; k < 3; k++){
                                var cy = (i * 50) + (k * (.5 *(400 - (i *100))));
                          if(j!=1 || k!=1){
                        var circle = new Kinetic.Circle({
                            x: cx,
                            y: cy,
                            radius: 10,
                            fill: 'red',
                            stroke: 'black',
                            strokeWidth: 4

                    });

      // add the shape to the layer
                    group.add(circle);
                }}}
                })();

            }


            shapesLayer.add(group);
            stage.add(shapesLayer);
        </script>
    </body>
</html>      
